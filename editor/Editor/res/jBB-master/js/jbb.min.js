!function(t){var e=function(t,e,n,a){var i=this;void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===a&&(a=1),this.red=0,this.green=0,this.blue=0,this.alpha=1,this.rgba=function(){return"rgba("+i.red+", "+i.green+", "+i.blue+", "+i.alpha+")"},this.set=function(t,e,n,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===a&&(a=1),i.red=t,i.green=e,i.blue=n,i.alpha=a},this.red=t,this.green=e,this.blue=n,this.alpha=a};(jBB||(jBB={})).jColor=e}(),function(t){var e=function(t,e,n){var o=this;this.set=function(t,e,n,a){void 0===t&&(t=16),void 0===e&&(e=!1),void 0===n&&(n=!1),void 0===a&&(a=0);var i="";1==e&&(i+=0<a?a:"bold "),1==n&&(i+="oblique "),o.ctx.data.canvas.ctx.font=i+t+"px "+o.name},this.draw=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=0),o.ctx.data.canvas.ctx.fillStyle=o.ctx.data.color.draw.rgba(),o.ctx.data.canvas.ctx.fillText(t,e,n)},this.ctx=n,this.name=e;var a=document.createElement("style");a.type="text/css",a.innerHTML="@font-face{ font-family: '"+this.name+"'; src: url("+t+"); }",document.body.appendChild(a)};(jBB||(jBB={})).jFont=e}(),function(t){var e=function(t,e,n,a,i,o){var u=this;this.img=new Image,this.loaded=!1,this.frame={num:1,width:0,height:0,start:1,current:1},this.hndl={x:0,y:0},this.autoMidHandle=!1,this.localMidHandle=!1,this.scaleFac={x:1,y:1},this.rotation=0,this.draw=function(t,e,n){void 0===n&&(n=1);var a=t,i=e;if(t/=u.scaleFac.x,e/=u.scaleFac.y,1==u.loaded){var o=u.getTilePos(n-1),c=t-u.hndl.x,s=e-u.hndl.y;(1==u.autoMidHandle||u.localMidHandle)&&(c-=u.frame.width/2,s-=u.frame.height/2),u.cnv.save(),u.cnv.translate(a,i),u.cnv.rotate(u.rotation*Math.PI/180),u.cnv.translate(-a,-i),u.cnv.scale(u.scaleFac.x,u.scaleFac.y),u.cnv.drawImage(u.img,o.x,o.y,u.frame.width,u.frame.height,c,s,u.frame.width,u.frame.height),u.cnv.scale(1,1),u.cnv.restore()}},this.handle=function(t,e){if(void 0===t&&(t=void 0),void 0===e&&(e=void 0),void 0===t)return 1==u.autoMidHandle||u.localMidHandle?{x:u.hndl.x+u.img.width/2,y:u.hndl.y+u.img.height/2}:u.hndl;t/=u.scaleFac.x,e/=u.scaleFac.y,u.hndl={x:t,y:e}},this.midHandle=function(t){u.localMidHandle=t},this.imageDataObject=function(){return u.ctx.clearBackbuffer(),u.ctx.data.canvas.bbf.drawImage(u.img,0,0),u.imgData=u.ctx.data.canvas.bbf.getImageData(0,0,u.img.width,u.img.height),u.imgData},this.width=function(){return u.img.width},this.height=function(){return u.img.height},this.rotate=function(t){u.rotation=t},this.scale=function(t,e){void 0===t&&(t=1),void 0===e&&(e=1),u.scaleFac={x:t,y:e}},this.rectOverlap=function(t,e,n,a,i,o){var c=t,s=e,d=t+u.img.width,r=e+u.img.height;return!(d<n||n+i<c||r<a||a+o<s)},this.cellsPerRow=function(){return u.img.width/u.frame.width},this.getTilePos=function(t){return{x:t%u.cellsPerRow()*u.frame.width,y:Math.floor(t/u.cellsPerRow())*u.frame.height}},this.getTileIndex=function(t,e){return t/u.frame.width+e/u.frame.height*u.cellsPerRow()},this.ctx=o,this.cnv=this.ctx.data.canvas.ctx,this.autoMidHandle=this.ctx.data.global.autoMidHandle,"string"==typeof t?(this.img.src=t,"number"==typeof e&&(this.frame.width=e),"number"==typeof n&&(this.frame.height=n),this.frame.start=a,this.frame.num=i,this.ctx=o,this.img.onload=function(t){u.loaded=!0,1===u.frame.num&&(u.frame.width=u.img.width,u.frame.height=u.img.height)}):"number"==typeof t&&(this.img.width=t,this.img.height=e,this.frame.num=n,this.ctx=a,this.img=new Image(t,e))};(jBB||(jBB={})).jImage=e}(),function(c){var t=function(t,e,n){var o=this;this.data={ready:!1,lastID:0,canvas:{element:null,ctx:null,bbf:null,id:"",x:0,y:0,width:640,height:480},mainLoop:"main",color:{cls:new c.jColor,draw:new c.jColor(255,255,255,1)},global:{autoMidHandle:!1,alpha:1,scale:1},mouse:null,keyboard:null,time:new c.jTime,font:{current:null,default:null}},this.createBackbuffer=function(){var t=document.createElement("canvas"),e=document.createTextNode("backbuffer");t.appendChild(e),t.id=o.data.canvas.id+"-bbuf",t.width=o.data.canvas.width,t.height=o.data.canvas.height,t.style.display="none",o.data.canvas.bbf=t.getContext("2d"),document.body.appendChild(t)},this.clearBackbuffer=function(){o.data.canvas.ctx.fillStyle="rgba(0, 0, 0, 0)",o.data.canvas.ctx.setTransform(1,0,0,1,0,0),o.data.canvas.ctx.fillRect(0,0,o.data.canvas.width,o.data.canvas.height)},this.getCanvasElement=function(){o.data.canvas.element=document.getElementById(o.data.canvas.id)},this.createCanvasElement=function(){o.data.canvas.element=document.createElement("canvas"),o.data.canvas.element.id=o.data.canvas.id,o.data.canvas.element.width=o.data.canvas.width,o.data.canvas.element.height=o.data.canvas.height,o.data.canvas.element.appendChild(document.createTextNode("your browser doesn't support the canvas element")),document.body.appendChild(o.data.canvas.element)},this.preRender=function(){o.data.canvas.ctx.save()},this.postRender=function(){o.data.canvas.ctx.restore()},this.render=function(){window.requestAnimationFrame(o.render),o.preRender(),window[o.data.mainLoop](),o.postRender()},this.mouseX=function(){return o.data.mouse.x},this.mouseY=function(){return o.data.mouse.y},this.mouseDown=function(t){return o.data.mouse.down(t)},this.mouseHit=function(t){return o.data.mouse.hit(t)},this.flushMouse=function(){o.data.mouse.flush()},this.getMouse=function(){return o.data.mouse.get()},this.keyDown=function(t){return o.data.keyboard.down(t)},this.keyHit=function(t){return o.data.keyboard.hit(t)},this.flushKeys=function(){o.data.keyboard.flush()},this.milliSecs=function(){return o.data.time.milliSecs()},this.rand=function(t,e){return o.data.time.rand(t,e)},this.cls=function(){o.data.canvas.ctx.fillStyle=o.data.color.cls.rgba(),o.data.canvas.ctx.setTransform(1,0,0,1,0,0),o.data.canvas.ctx.fillRect(0,0,o.data.canvas.width,o.data.canvas.height)},this.clsColor=function(t,e,n){o.data.color.cls.set(t,e,n)},this.color=function(t,e,n,a){void 0===t&&(t=255),void 0===e&&(e=255),void 0===n&&(n=255),void 0===a&&(a=1),o.data.color.draw.set(t,e,n,a)},this.graphicsWidth=function(){return o.data.canvas.width},this.graphicsHeight=function(){return o.data.canvas.height},this.tFormFilter=function(t){o.data.canvas.ctx.imageSmoothingEnabled=t},this.rect=function(t,e,n,a,i){void 0===i&&(i=!0),i?(o.data.canvas.ctx.fillStyle=o.data.color.draw.rgba(),o.data.canvas.ctx.fillRect(t,e,n,a)):(o.data.canvas.ctx.strokeStyle=o.data.color.draw.rgba(),o.data.canvas.ctx.strokeRect(t,e,n,a))},this.line=function(t,e,n,a){o.data.canvas.ctx.strokeStyle=o.data.color.draw.rgba(),o.data.canvas.ctx.beginPath(),o.data.canvas.ctx.moveTo(t,e),o.data.canvas.ctx.lineTo(n,a),o.data.canvas.ctx.stroke()},this.loadFont=function(t,e){return o.data.font.current=new c.jFont(t,e,o),o.data.font.current},this.setFont=function(t,e,n,a,i){void 0===e&&(e=16),void 0===n&&(n=!1),void 0===a&&(a=!1),void 0===i&&(i=0),o.data.font.current=t,o.data.font.current.set(e,n,a,i)},this.drawText=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=0),o.data.font.current instanceof c.jFont?o.data.font.current.draw(t,e,n):o.data.font.default.draw(t,e,n)},this.autoMidHandle=function(t){o.data.global.autoMidHandle=t},this.midHandle=function(t,e){t.midHandle(e)},this.loadImage=function(t,e,n,a,i){return void 0===a&&(a=1),void 0===i&&(i=1),new c.jImage(t,e,n,a,i,o)},this.drawImage=function(t,e,n,a){void 0===a&&(a=1),t.draw(e,n,a)},this.imageWidth=function(t){return t.width()},this.imageHeight=function(t){return t.height()},this.rotateImage=function(t,e){t.rotate(e)},this.imageHandle=function(t){return 1==t.loaded?t.handle():0},this.scaleImage=function(t,e,n){void 0===e&&(e=1),void 0===n&&(n=1),t.scale(e,n)},this.createImage=function(t,e,n){return new c.jImage(t,e,n,o)},this.imageRectOverlap=function(t,e,n,a,i,o,c){return t.rectOverlap(e,n,a,i,o,c)},"number"==typeof t?(this.data.lastID++,this.data.canvas.id="jbbCanvas"+this.data.lastID,this.data.canvas.width=t,"number"==typeof e&&(this.data.canvas.height=e),"string"==typeof n&&(this.data.mainLoop=n),this.createCanvasElement()):"string"==typeof t&&(this.data.canvas.id=t,"string"==typeof e&&(this.data.mainLoop=e),this.getCanvasElement()),this.data.canvas.ctx=this.data.canvas.element.getContext("2d"),this.data.canvas.ctx.lineWidth=1,this.data.mouse=new c.jMouse(this),this.data.keyboard=new c.jKeyboard(this),this.data.font.default=new c.jFont("","Arial",this),window.onload=function(){o.data.ready=!0},this.createBackbuffer(),window.requestAnimationFrame(this.render)};c.Core=t}(jBB||(jBB={})),function(t){var e=function(t){var n=this;this.saveKeyDown=function(t){n.keys[t.keyCode]=!0},this.saveKeyUp=function(t){n.keys[t.keyCode]=!1},this.down=function(t){return n.keys[t]},this.hit=function(t){var e=n.keys[t];return n.keys[t]=!1,e},this.flush=function(){for(var t in n.keys)n.keys[t]=!1},this.ctx=t,this.ctx.data.canvas.element.onkeydown=this.saveKeyDown,this.ctx.data.canvas.element.onkeyup=this.saveKeyUp};(jBB||(jBB={})).jKeyboard=e}(),function(t){var e=function(t){var n=this;this.saveMousePos=function(t){var e=n.ctx.data.canvas.element.getBoundingClientRect();n.x=t.clientX-e.left,n.y=t.clientY-e.top},this.saveMouseDown=function(t){n.keys[t.button]=!0},this.saveMouseUp=function(t){n.keys[t.button]=!1},this.down=function(t){return n.keys[t]},this.hit=function(t){var e=n.keys[t];return n.keys[t]=!1,e},this.flush=function(){for(var t in n.keys)n.keys[t]=!1},this.get=function(){var t=[];for(var e in n.keys)n.keys[e]&&t.push(Number(e));return t},this.ctx=t,this.keys=[],this.ctx.data.canvas.element.onmousemove=this.saveMousePos,this.ctx.data.canvas.element.onmousedown=this.saveMouseDown,this.ctx.data.canvas.element.onmouseup=this.saveMouseUp};(jBB||(jBB={})).jMouse=e}();var jBB,jBBContext={context:void 0};function Graphics(t,e,n){void 0===t&&(t=640),void 0===e&&(e=480),void 0===n&&(n="main"),jBBContext.context=new jBB.Core(t,e,n)}function Cls(){jBBContext.context.cls()}function ClsColor(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),jBBContext.context.clsColor(t,e,n)}function Color(t,e,n,a){void 0===t&&(t=255),void 0===e&&(e=255),void 0===n&&(n=255),void 0===a&&(a=1),jBBContext.context.color(t,e,n,a)}function GraphicsWidth(){return jBBContext.context.graphicsWidth()}function GraphicsHeight(){return jBBContext.context.graphicsHeight()}function TFormFilter(t){jBBContext.context.tFormFilter(t)}function Rect(t,e,n,a,i){void 0===i&&(i=1);jBBContext.context.rect(t,e,n,a,i)}function Line(t,e,n,a){jBBContext.context.line(t,e,n,a)}function LoadFont(t,e){return jBBContext.context.loadFont(t,e)}function SetFont(t,e,n,a){void 0===e&&(e=16),void 0===n&&(n=!1),void 0===a&&(a=!1),jBBContext.context.setFont(t,e,n,a)}function DrawText(t,e,n){void 0===e&&(e=0),void 0===n&&(n=0),jBBContext.context.drawText(t,e,n)}function AutoMidHandle(t){jBBContext.context.autoMidHandle(t)}function MidHandle(t,e){jBBContext.context.midHandle(t,e)}function LoadImage(t,e,n,a,i){return void 0===a&&(a=1),void 0===i&&(i=1),jBBContext.context.loadImage(t,e,n,a,i)}function DrawImage(t,e,n,a){void 0===a&&(a=1),jBBContext.context.drawImage(t,e,n,a)}function HandleImage(t,e,n){t.handle(e,n)}function ImageWidth(t){return jBBContext.context.imageWidth(t)}function ImageHeight(t){return jBBContext.context.imageHeight(t)}function RotateImage(t,e){jBBContext.context.rotateImage(t,e)}function ImageXHandle(t){return jBBContext.context.imageHandle(t).x}function ImageYHandle(t){return jBBContext.context.imageHandle(t).y}function ScaleImage(t,e,n){void 0===e&&(e=1),void 0===n&&(n=1),jBBContext.context.scaleImage(t,e,n)}function CreateImage(t,e,n){return void 0===n&&(n=1),new jBB.jImage(t,e,n,jBBContext.context)}function ImageRectOverlap(t,e,n,a,i,o,c){return jBBContext.context.imageRectOverlap(t,e,n,a,i,o,c)}function MouseX(){return jBBContext.context.mouseX()}function MouseY(){return jBBContext.context.mouseY()}function MouseHit(t){return jBBContext.context.mouseHit(t)}function MouseDown(t){return jBBContext.context.mouseDown(t)}function FlushMouse(){jBBContext.context.flushMouse()}function GetMouse(){return jBBContext.context.getMouse()}function KeyDown(t){return jBBContext.context.keyDown(t)}function KeyHit(t){return jBBContext.context.keyHit(t)}function FlushKeys(){jBBContext.context.flushKeys()}function MilliSecs(){return jBBContext.context.milliSecs()}!function(t){var e=function(){this.milliSecs=function(){return(new Date).getTime()},this.rand=function(t,e){return Math.floor(Math.random()*e)+t}};(jBB||(jBB={})).jTime=e}();